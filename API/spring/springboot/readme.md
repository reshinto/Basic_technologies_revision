# Springboot guide
## Install springboot
1. method 1: ```brew install springboot```
2. method 2: ```curl -s "https://get.sdkman.io" | bash```
    - ```source "$HOME/.sdkman/bin/sdkman-init.sh"```
    - Install springboot
      - ```sdk install springboot```
## Create new project
- get list of avaliable dependencies
  - ```spring init --list```
- create a new web dependency project using maven
  - ```spring init --dependencies web --build maven --groupId groupName --artifactId projectName --name projectName saveAsThisFolderName```
  - ```spring init -d web --build maven -g groupName -a projectName -n projectName saveAsThisFolderName```
  - ```spring init -d web,data-jdbc,postgresql --build maven -g groupName -a projectName -n projectName saveAsThisFolderName```
## Inside the project
### pom.xml
- similar to the package.json file for JavaScript
- contains the parent library which is spring boot and the list of dependencies installed
### src/main/resources/application.properties
- file to configure all the properties for the app and for environment specific properties
- it will be used when connected to a real database
### src/main/resources/static/ && src/main/resources/templates/
- these are for web development related files such as html, css, javascript
### default code in the src/main/java/.../appname/AppName.java
```java
package com.example.demoapi;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class DemoApiApplication {
	public static void main(String[] args) {
		SpringApplication.run(DemoApiApplication.class, args);
	}
}
```
## create a simple class model that creates tables in the database
### e.g.: src/java/.../appname/classname/ModelName.java
- this will enable database to auto create a table and sequence related to this file
```java
package com.example.demoapi.student;

import java.time.LocalDate;
import java.time.Period;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;
import javax.persistence.SequenceGenerator;
import javax.persistence.Table;
import javax.persistence.Transient

@Entity  // required for hibernate
@Table  // required for table in the database
public class Student {
  @Id
  @SequenceGenerator(name = "student_sequence", sequenceName = "student_sequence", allocationSize = 1)
  @GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "student_sequence")
  private Long id;
  private String name;
  private String email;
  private LocalDate dob;
  @Transient  // helps to auto calculate age
  private Integer age;
  
  public Student() {
  }

  public Student(Long id, String name, String email, LocalDate dob) {
    this.id = id;
    this.name = name;
    this.email = email;
    this.dob = dob;
  }

  // ids are auto generated by database
  public Student(String name, String email, LocalDate dob) {
    this.name = name;
    this.email = email;
    this.dob = dob;
  }

  public Long getId() {
    return id;
  }

  public void setId(Long id) {
    this.id = id;
  }

  public String getName() {
    return name;
  }

  public void setName(String name) {
    this.name = name;
  }

  public String getEmail() {
    return email;
  }

  public void setEmail(String email) {
    this.email = email;
  }

  public LocalDate getDob() {
    return dob;
  }

  public void setDob(LocalDate dob) {
    this.dob = dob;
  }

  public Integer getAge() {
    return Period.between(dob, LocalDate.now()).getYears();
  }

  public void setAge(Integer age) {
    this.age = age;
  }

  @Override
  public String toString() {
    return "Student{" + "id=" + id + ", name='" + name + '\'' + ", email='" + email + '\'' + ", dob=" + dob + ", age="
        + age + '}';
  }
}
```
## create a service to link the database to the controller
### e.g.: src/main/java/.../appname/classname/ClassNameService.java
- gain data access by querying in the database
```java
package com.example.demoapi.student;

import java.util.List;
import java.util.Optional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

// @Component also works, but better to be specific as this is a Service
@Service  // this states that StudentService needs to be instantiated (must be a spring bean) linking it to @Autowired in the controller
public class StudentService {

  private final StudentRepository studentRepository;

  @Autowired  // this states that StudentRepository should be autowired by being instantiated and then injected into this constructor
  public StudentService(StudentRepository studentRepository) {
    this.studentRepository = studentRepository;
  }

  // uses the built-in methods to query the database to return the JSON data
  public List<Student> getStudents() {
    return studentRepository.findAll();
  }
	
	public void addNewStudent(Student student) {
		// check if email already exist, if yes return an error, if no save the new student
    Optional<Student> studentOptional = studentRepository.findStudentByEmail((student.getEmail()));
    if (studentOptional.isPresent()) {
      throw new IllegalStateException("email taken");
    }
    studentRepository.save(student);
  }
}
```
## create and enable restful framework by creating a class controller and linking it with the service
### e.g.: src/main/java/.../appname/classname/ClassNameController.java
```java
package com.example.demoapi.student;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RequestMapping(path = "api/v1/student")
public class StudentController {

  private final StudentService studentService;

  @Autowired  // this states that StudentService should be autowired by being instantiated and then injected into this constructor
  public StudentController(StudentService studentService) {
    this.studentService = studentService;  // use dependency injection instead of manually instantiating here
  }

  // enable get request
  @GetMapping
  public List<Student> getStudents() {
    return studentService.getStudents();
  }
  
  // enable post request
  @PostMapping
  public void registerNewStudent(@RequestBody Student student) {  // @RequestBody enable retrieve payload from body
    studentService.addNewStudent(student);
  }
}
```
## setup environment settings to connect to postgresql in src/main/resources/application.properties
```
spring.datasource.url=jdbc:postgresql://localhost:5432/databaseName
spring.datasource.username=
spring.datasource.password=
spring.jpa.hibernate.ddl-auto=create-drop
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialet=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=true

// allow display of error message in the response during an error
server.error.include-message=always
```
## create an interface that is responsible for data access src/main/java/.../appname/classname/ClassNameRepository.java
```java
package com.example.demoapi.student;

import java.util.Optional;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.stereotype.Repository;

@Repository
public interface StudentRepository extends JpaRepository<Student, Long> {

  // method 1: SELECT * FROM student WHERE email = ?
  // Optional<Student> findStudentByEmail(String email);

  // method 2: be more specific, the following is JPQL query and not SQL
  // Student refers to the Student class
  @Query("SELECT s FROM Student s WHERE s.email = ?1")
  Optional<Student> findStudentByEmail(String email);
}
```
## create a config file that seeds the table contents src/main/java/.../appname/classname/ClassNameConfig.java
```java
package com.example.demoapi.student;

import java.time.LocalDate;
import java.time.Month;
import java.util.List;

import org.springframework.boot.CommandLineRunner;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class StudentConfig {

  @Bean
  CommandLineRunner commandLineRunner(StudentRepository repository) {
    return args -> {
      Student studentA = new Student("Name1", "name1@gmail.com", LocalDate.of(2000, Month.JANUARY, 5));

      Student studentB = new Student("Name2", "name2@gmail.com", LocalDate.of(2004, Month.FEBRUARY, 10));

      repository.saveAll(List.of(studentA, studentB));
    };
  }
}
```
